-- CDC Tables Creation Script for backend
-- Generated at: 2025-08-07T16:31:07.675Z
-- Prefix: _cdc_
-- DO NOT EDIT THIS FILE MANUALLY

-- ============================================
-- CDC Table for: users
-- Description: User account changes
-- ============================================

CREATE TABLE IF NOT EXISTS "_cdc_users" (
  -- CDC Metadata Columns
  "_cdc_id" SERIAL PRIMARY KEY,
  "_cdc_timestamp" TIMESTAMP NOT NULL DEFAULT NOW(),
  "_cdc_operation" VARCHAR(10) NOT NULL CHECK ("_cdc_operation" IN ('INSERT', 'UPDATE', 'DELETE')),
  "_cdc_acknowledge" BOOLEAN NOT NULL DEFAULT FALSE,
  
  -- Original Table Columns
  "id" INTEGER,
  "email" VARCHAR(254),
  "alias" VARCHAR(100),
  "first_name" VARCHAR(50),
  "last_name" VARCHAR(50),
  "profile_picture" VARCHAR(2083),
  "url" VARCHAR(2083),
  "bio" TEXT,
  "birthday" DATE,
  "gender" VARCHAR(20),
  "locale" VARCHAR(5),
  "timezone" VARCHAR(255),
  "location" VARCHAR(255),
  "phone" VARCHAR(50),
  "address" TEXT,
  "company" INTEGER,
  "is_deleted" BOOLEAN,
  "edited_at" TIMESTAMP,
  "edited_by" INTEGER,
  "edited_session" VARCHAR
);

-- Indexes
CREATE INDEX IF NOT EXISTS "idx__cdc_users_timestamp" ON "_cdc_users" ("_cdc_timestamp");
CREATE INDEX IF NOT EXISTS "idx__cdc_users_operation" ON "_cdc_users" ("_cdc_operation");
CREATE INDEX IF NOT EXISTS "idx__cdc_users_acknowledge" ON "_cdc_users" ("_cdc_acknowledge");
CREATE INDEX IF NOT EXISTS "idx__cdc_users_unprocessed" ON "_cdc_users" ("_cdc_acknowledge", "_cdc_timestamp") WHERE "_cdc_acknowledge" = FALSE;

-- ============================================
-- CDC Table for: roles
-- Description: Role definition changes
-- ============================================

CREATE TABLE IF NOT EXISTS "_cdc_roles" (
  -- CDC Metadata Columns
  "_cdc_id" SERIAL PRIMARY KEY,
  "_cdc_timestamp" TIMESTAMP NOT NULL DEFAULT NOW(),
  "_cdc_operation" VARCHAR(10) NOT NULL CHECK ("_cdc_operation" IN ('INSERT', 'UPDATE', 'DELETE')),
  "_cdc_acknowledge" BOOLEAN NOT NULL DEFAULT FALSE,
  
  -- Original Table Columns
  "id" INTEGER,
  "name" VARCHAR(100),
  "label" VARCHAR(100),
  "role_group" VARCHAR(100),
  "description" VARCHAR(255),
  "is_deleted" BOOLEAN,
  "edited_at" TIMESTAMP,
  "edited_by" INTEGER,
  "edited_session" VARCHAR
);

-- Indexes
CREATE INDEX IF NOT EXISTS "idx__cdc_roles_timestamp" ON "_cdc_roles" ("_cdc_timestamp");
CREATE INDEX IF NOT EXISTS "idx__cdc_roles_operation" ON "_cdc_roles" ("_cdc_operation");
CREATE INDEX IF NOT EXISTS "idx__cdc_roles_acknowledge" ON "_cdc_roles" ("_cdc_acknowledge");
CREATE INDEX IF NOT EXISTS "idx__cdc_roles_unprocessed" ON "_cdc_roles" ("_cdc_acknowledge", "_cdc_timestamp") WHERE "_cdc_acknowledge" = FALSE;

-- ============================================
-- CDC Table for: permissions
-- Description: Permission definition changes
-- ============================================

CREATE TABLE IF NOT EXISTS "_cdc_permissions" (
  -- CDC Metadata Columns
  "_cdc_id" SERIAL PRIMARY KEY,
  "_cdc_timestamp" TIMESTAMP NOT NULL DEFAULT NOW(),
  "_cdc_operation" VARCHAR(10) NOT NULL CHECK ("_cdc_operation" IN ('INSERT', 'UPDATE', 'DELETE')),
  "_cdc_acknowledge" BOOLEAN NOT NULL DEFAULT FALSE,
  
  -- Original Table Columns
  "id" INTEGER,
  "name" VARCHAR(100),
  "label" VARCHAR(100),
  "permission_group" VARCHAR(100),
  "description" VARCHAR(255)
);

-- Indexes
CREATE INDEX IF NOT EXISTS "idx__cdc_permissions_timestamp" ON "_cdc_permissions" ("_cdc_timestamp");
CREATE INDEX IF NOT EXISTS "idx__cdc_permissions_operation" ON "_cdc_permissions" ("_cdc_operation");
CREATE INDEX IF NOT EXISTS "idx__cdc_permissions_acknowledge" ON "_cdc_permissions" ("_cdc_acknowledge");
CREATE INDEX IF NOT EXISTS "idx__cdc_permissions_unprocessed" ON "_cdc_permissions" ("_cdc_acknowledge", "_cdc_timestamp") WHERE "_cdc_acknowledge" = FALSE;

-- ============================================
-- CDC Table for: permissionsUsersMap
-- Description: User permission assignments
-- ============================================

CREATE TABLE IF NOT EXISTS "_cdc_permissionsUsersMap" (
  -- CDC Metadata Columns
  "_cdc_id" SERIAL PRIMARY KEY,
  "_cdc_timestamp" TIMESTAMP NOT NULL DEFAULT NOW(),
  "_cdc_operation" VARCHAR(10) NOT NULL CHECK ("_cdc_operation" IN ('INSERT', 'UPDATE', 'DELETE')),
  "_cdc_acknowledge" BOOLEAN NOT NULL DEFAULT FALSE,
  
  -- Original Table Columns
  "permission_id" INTEGER,
  "user_id" INTEGER,
  "referenceable_type" VARCHAR(50),
  "referenceable_id" INTEGER,
  "is_deleted" BOOLEAN,
  "edited_at" TIMESTAMP,
  "edited_by" INTEGER,
  "edited_session" VARCHAR
);

-- Indexes
CREATE INDEX IF NOT EXISTS "idx__cdc_permissionsUsersMap_timestamp" ON "_cdc_permissionsUsersMap" ("_cdc_timestamp");
CREATE INDEX IF NOT EXISTS "idx__cdc_permissionsUsersMap_operation" ON "_cdc_permissionsUsersMap" ("_cdc_operation");
CREATE INDEX IF NOT EXISTS "idx__cdc_permissionsUsersMap_acknowledge" ON "_cdc_permissionsUsersMap" ("_cdc_acknowledge");
CREATE INDEX IF NOT EXISTS "idx__cdc_permissionsUsersMap_unprocessed" ON "_cdc_permissionsUsersMap" ("_cdc_acknowledge", "_cdc_timestamp") WHERE "_cdc_acknowledge" = FALSE;

-- ============================================
-- CDC Table for: permissionsRolesMap
-- Description: Role permission assignments
-- ============================================

CREATE TABLE IF NOT EXISTS "_cdc_permissionsRolesMap" (
  -- CDC Metadata Columns
  "_cdc_id" SERIAL PRIMARY KEY,
  "_cdc_timestamp" TIMESTAMP NOT NULL DEFAULT NOW(),
  "_cdc_operation" VARCHAR(10) NOT NULL CHECK ("_cdc_operation" IN ('INSERT', 'UPDATE', 'DELETE')),
  "_cdc_acknowledge" BOOLEAN NOT NULL DEFAULT FALSE,
  
  -- Original Table Columns
  "permission_id" INTEGER,
  "role_id" INTEGER,
  "referenceable_type" VARCHAR(50),
  "referenceable_id" INTEGER,
  "is_deleted" BOOLEAN,
  "edited_at" TIMESTAMP,
  "edited_by" INTEGER,
  "edited_session" VARCHAR
);

-- Indexes
CREATE INDEX IF NOT EXISTS "idx__cdc_permissionsRolesMap_timestamp" ON "_cdc_permissionsRolesMap" ("_cdc_timestamp");
CREATE INDEX IF NOT EXISTS "idx__cdc_permissionsRolesMap_operation" ON "_cdc_permissionsRolesMap" ("_cdc_operation");
CREATE INDEX IF NOT EXISTS "idx__cdc_permissionsRolesMap_acknowledge" ON "_cdc_permissionsRolesMap" ("_cdc_acknowledge");
CREATE INDEX IF NOT EXISTS "idx__cdc_permissionsRolesMap_unprocessed" ON "_cdc_permissionsRolesMap" ("_cdc_acknowledge", "_cdc_timestamp") WHERE "_cdc_acknowledge" = FALSE;

-- ============================================
-- CDC Table for: usersRolesMap
-- Description: User role assignments
-- ============================================

CREATE TABLE IF NOT EXISTS "_cdc_usersRolesMap" (
  -- CDC Metadata Columns
  "_cdc_id" SERIAL PRIMARY KEY,
  "_cdc_timestamp" TIMESTAMP NOT NULL DEFAULT NOW(),
  "_cdc_operation" VARCHAR(10) NOT NULL CHECK ("_cdc_operation" IN ('INSERT', 'UPDATE', 'DELETE')),
  "_cdc_acknowledge" BOOLEAN NOT NULL DEFAULT FALSE,
  
  -- Original Table Columns
  "user_id" INTEGER,
  "role_id" INTEGER,
  "referenceable_type" VARCHAR(50),
  "referenceable_id" INTEGER,
  "is_deleted" BOOLEAN,
  "edited_at" TIMESTAMP,
  "edited_by" INTEGER,
  "edited_session" VARCHAR
);

-- Indexes
CREATE INDEX IF NOT EXISTS "idx__cdc_usersRolesMap_timestamp" ON "_cdc_usersRolesMap" ("_cdc_timestamp");
CREATE INDEX IF NOT EXISTS "idx__cdc_usersRolesMap_operation" ON "_cdc_usersRolesMap" ("_cdc_operation");
CREATE INDEX IF NOT EXISTS "idx__cdc_usersRolesMap_acknowledge" ON "_cdc_usersRolesMap" ("_cdc_acknowledge");
CREATE INDEX IF NOT EXISTS "idx__cdc_usersRolesMap_unprocessed" ON "_cdc_usersRolesMap" ("_cdc_acknowledge", "_cdc_timestamp") WHERE "_cdc_acknowledge" = FALSE;

-- ============================================
-- CDC Table for: usersGroups
-- Description: User group definitions
-- ============================================

CREATE TABLE IF NOT EXISTS "_cdc_usersGroups" (
  -- CDC Metadata Columns
  "_cdc_id" SERIAL PRIMARY KEY,
  "_cdc_timestamp" TIMESTAMP NOT NULL DEFAULT NOW(),
  "_cdc_operation" VARCHAR(10) NOT NULL CHECK ("_cdc_operation" IN ('INSERT', 'UPDATE', 'DELETE')),
  "_cdc_acknowledge" BOOLEAN NOT NULL DEFAULT FALSE,
  
  -- Original Table Columns
  "id" INTEGER,
  "name" VARCHAR(100),
  "is_deleted" BOOLEAN,
  "edited_at" TIMESTAMP,
  "edited_by" INTEGER,
  "edited_session" VARCHAR
);

-- Indexes
CREATE INDEX IF NOT EXISTS "idx__cdc_usersGroups_timestamp" ON "_cdc_usersGroups" ("_cdc_timestamp");
CREATE INDEX IF NOT EXISTS "idx__cdc_usersGroups_operation" ON "_cdc_usersGroups" ("_cdc_operation");
CREATE INDEX IF NOT EXISTS "idx__cdc_usersGroups_acknowledge" ON "_cdc_usersGroups" ("_cdc_acknowledge");
CREATE INDEX IF NOT EXISTS "idx__cdc_usersGroups_unprocessed" ON "_cdc_usersGroups" ("_cdc_acknowledge", "_cdc_timestamp") WHERE "_cdc_acknowledge" = FALSE;

-- ============================================
-- CDC Table for: usersGroupsMap
-- Description: User group memberships
-- ============================================

CREATE TABLE IF NOT EXISTS "_cdc_usersGroupsMap" (
  -- CDC Metadata Columns
  "_cdc_id" SERIAL PRIMARY KEY,
  "_cdc_timestamp" TIMESTAMP NOT NULL DEFAULT NOW(),
  "_cdc_operation" VARCHAR(10) NOT NULL CHECK ("_cdc_operation" IN ('INSERT', 'UPDATE', 'DELETE')),
  "_cdc_acknowledge" BOOLEAN NOT NULL DEFAULT FALSE,
  
  -- Original Table Columns
  "user_id" INTEGER,
  "users_group_id" INTEGER,
  "is_deleted" BOOLEAN,
  "edited_at" TIMESTAMP,
  "edited_by" INTEGER,
  "edited_session" VARCHAR
);

-- Indexes
CREATE INDEX IF NOT EXISTS "idx__cdc_usersGroupsMap_timestamp" ON "_cdc_usersGroupsMap" ("_cdc_timestamp");
CREATE INDEX IF NOT EXISTS "idx__cdc_usersGroupsMap_operation" ON "_cdc_usersGroupsMap" ("_cdc_operation");
CREATE INDEX IF NOT EXISTS "idx__cdc_usersGroupsMap_acknowledge" ON "_cdc_usersGroupsMap" ("_cdc_acknowledge");
CREATE INDEX IF NOT EXISTS "idx__cdc_usersGroupsMap_unprocessed" ON "_cdc_usersGroupsMap" ("_cdc_acknowledge", "_cdc_timestamp") WHERE "_cdc_acknowledge" = FALSE;

-- ============================================
-- CDC Table for: permissionsGroupsMap
-- Description: Group permission assignments
-- ============================================

CREATE TABLE IF NOT EXISTS "_cdc_permissionsGroupsMap" (
  -- CDC Metadata Columns
  "_cdc_id" SERIAL PRIMARY KEY,
  "_cdc_timestamp" TIMESTAMP NOT NULL DEFAULT NOW(),
  "_cdc_operation" VARCHAR(10) NOT NULL CHECK ("_cdc_operation" IN ('INSERT', 'UPDATE', 'DELETE')),
  "_cdc_acknowledge" BOOLEAN NOT NULL DEFAULT FALSE,
  
  -- Original Table Columns
  "permission_id" INTEGER,
  "users_group_id" INTEGER,
  "referenceable_type" VARCHAR(50),
  "referenceable_id" INTEGER,
  "is_deleted" BOOLEAN,
  "edited_at" TIMESTAMP,
  "edited_by" INTEGER,
  "edited_session" VARCHAR
);

-- Indexes
CREATE INDEX IF NOT EXISTS "idx__cdc_permissionsGroupsMap_timestamp" ON "_cdc_permissionsGroupsMap" ("_cdc_timestamp");
CREATE INDEX IF NOT EXISTS "idx__cdc_permissionsGroupsMap_operation" ON "_cdc_permissionsGroupsMap" ("_cdc_operation");
CREATE INDEX IF NOT EXISTS "idx__cdc_permissionsGroupsMap_acknowledge" ON "_cdc_permissionsGroupsMap" ("_cdc_acknowledge");
CREATE INDEX IF NOT EXISTS "idx__cdc_permissionsGroupsMap_unprocessed" ON "_cdc_permissionsGroupsMap" ("_cdc_acknowledge", "_cdc_timestamp") WHERE "_cdc_acknowledge" = FALSE;

-- ============================================
-- CDC Table for: projects
-- Description: Project information changes
-- ============================================

CREATE TABLE IF NOT EXISTS "_cdc_projects" (
  -- CDC Metadata Columns
  "_cdc_id" SERIAL PRIMARY KEY,
  "_cdc_timestamp" TIMESTAMP NOT NULL DEFAULT NOW(),
  "_cdc_operation" VARCHAR(10) NOT NULL CHECK ("_cdc_operation" IN ('INSERT', 'UPDATE', 'DELETE')),
  "_cdc_acknowledge" BOOLEAN NOT NULL DEFAULT FALSE,
  
  -- Original Table Columns
  "id" INTEGER,
  "name" VARCHAR(100),
  "location" VARCHAR(100),
  "description" VARCHAR(255),
  "status" VARCHAR(100),
  "company_id" INTEGER,
  "is_deleted" BOOLEAN,
  "edited_at" TIMESTAMP,
  "edited_by" INTEGER,
  "edited_session" VARCHAR
);

-- Indexes
CREATE INDEX IF NOT EXISTS "idx__cdc_projects_timestamp" ON "_cdc_projects" ("_cdc_timestamp");
CREATE INDEX IF NOT EXISTS "idx__cdc_projects_operation" ON "_cdc_projects" ("_cdc_operation");
CREATE INDEX IF NOT EXISTS "idx__cdc_projects_acknowledge" ON "_cdc_projects" ("_cdc_acknowledge");
CREATE INDEX IF NOT EXISTS "idx__cdc_projects_unprocessed" ON "_cdc_projects" ("_cdc_acknowledge", "_cdc_timestamp") WHERE "_cdc_acknowledge" = FALSE;

-- ============================================
-- CDC Table for: functionalUnits
-- Description: Functional unit changes
-- ============================================

CREATE TABLE IF NOT EXISTS "_cdc_functionalUnits" (
  -- CDC Metadata Columns
  "_cdc_id" SERIAL PRIMARY KEY,
  "_cdc_timestamp" TIMESTAMP NOT NULL DEFAULT NOW(),
  "_cdc_operation" VARCHAR(10) NOT NULL CHECK ("_cdc_operation" IN ('INSERT', 'UPDATE', 'DELETE')),
  "_cdc_acknowledge" BOOLEAN NOT NULL DEFAULT FALSE,
  
  -- Original Table Columns
  "id" INTEGER,
  "name" VARCHAR(100),
  "description" VARCHAR(255),
  "floor" INTEGER,
  "unit" VARCHAR(100),
  "status" VARCHAR(100),
  "type" TEXT,
  "orientation" VARCHAR(100),
  "bedrooms" INTEGER,
  "toilettes" INTEGER,
  "bathrooms" INTEGER,
  "equivalent_square_meters" INTEGER,
  "covered_square_meters" INTEGER,
  "semicovered_square_meters" INTEGER,
  "non_covered_square_meters" INTEGER,
  "common_square_meters_prorated" INTEGER,
  "sub_total_square_meters" INTEGER,
  "total_sale_square_meters" INTEGER,
  "fyf_enabled" BOOLEAN,
  "constant_unit_price_advancement" INTEGER,
  "constant_unit_price_advancement_date" TIMESTAMP,
  "constant_unit_price_payments" INTEGER,
  "constant_unit_price_payments_date" TIMESTAMP,
  "valuation_currency" INTEGER,
  "value" INTEGER,
  "date_value" TIMESTAMP,
  "fyf_discount" INTEGER,
  "advancement_per" TEXT,
  "payments_count" INTEGER,
  "payments_start_date" TIMESTAMP,
  "project_id" INTEGER,
  "is_deleted" BOOLEAN,
  "edited_at" TIMESTAMP,
  "edited_by" INTEGER,
  "edited_session" VARCHAR
);

-- Indexes
CREATE INDEX IF NOT EXISTS "idx__cdc_functionalUnits_timestamp" ON "_cdc_functionalUnits" ("_cdc_timestamp");
CREATE INDEX IF NOT EXISTS "idx__cdc_functionalUnits_operation" ON "_cdc_functionalUnits" ("_cdc_operation");
CREATE INDEX IF NOT EXISTS "idx__cdc_functionalUnits_acknowledge" ON "_cdc_functionalUnits" ("_cdc_acknowledge");
CREATE INDEX IF NOT EXISTS "idx__cdc_functionalUnits_unprocessed" ON "_cdc_functionalUnits" ("_cdc_acknowledge", "_cdc_timestamp") WHERE "_cdc_acknowledge" = FALSE;

-- ============================================
-- CDC Table for: fsNodes
-- Description: File system node changes
-- ============================================

CREATE TABLE IF NOT EXISTS "_cdc_fsNodes" (
  -- CDC Metadata Columns
  "_cdc_id" SERIAL PRIMARY KEY,
  "_cdc_timestamp" TIMESTAMP NOT NULL DEFAULT NOW(),
  "_cdc_operation" VARCHAR(10) NOT NULL CHECK ("_cdc_operation" IN ('INSERT', 'UPDATE', 'DELETE')),
  "_cdc_acknowledge" BOOLEAN NOT NULL DEFAULT FALSE,
  
  -- Original Table Columns
  "id" INTEGER,
  "name" VARCHAR(255),
  "type" TEXT,
  "path" VARCHAR(500),
  "public_path" VARCHAR(500),
  "size" INTEGER,
  "child_folders_count" INTEGER,
  "child_files_count" INTEGER,
  "original_name" VARCHAR(255),
  "mime_type" VARCHAR(100),
  "referenceable_type" VARCHAR(50),
  "referenceable_id" INTEGER,
  "is_deleted" BOOLEAN,
  "edited_at" TIMESTAMP,
  "edited_by" INTEGER,
  "edited_session" VARCHAR
);

-- Indexes
CREATE INDEX IF NOT EXISTS "idx__cdc_fsNodes_timestamp" ON "_cdc_fsNodes" ("_cdc_timestamp");
CREATE INDEX IF NOT EXISTS "idx__cdc_fsNodes_operation" ON "_cdc_fsNodes" ("_cdc_operation");
CREATE INDEX IF NOT EXISTS "idx__cdc_fsNodes_acknowledge" ON "_cdc_fsNodes" ("_cdc_acknowledge");
CREATE INDEX IF NOT EXISTS "idx__cdc_fsNodes_unprocessed" ON "_cdc_fsNodes" ("_cdc_acknowledge", "_cdc_timestamp") WHERE "_cdc_acknowledge" = FALSE;

-- ============================================
-- CDC Table for: comments
-- Description: Comment changes
-- ============================================

CREATE TABLE IF NOT EXISTS "_cdc_comments" (
  -- CDC Metadata Columns
  "_cdc_id" SERIAL PRIMARY KEY,
  "_cdc_timestamp" TIMESTAMP NOT NULL DEFAULT NOW(),
  "_cdc_operation" VARCHAR(10) NOT NULL CHECK ("_cdc_operation" IN ('INSERT', 'UPDATE', 'DELETE')),
  "_cdc_acknowledge" BOOLEAN NOT NULL DEFAULT FALSE,
  
  -- Original Table Columns
  "id" INTEGER,
  "content" TEXT,
  "referenceable_type" VARCHAR(50),
  "referenceable_id" INTEGER,
  "is_deleted" BOOLEAN,
  "edited_at" TIMESTAMP,
  "edited_by" INTEGER,
  "edited_session" VARCHAR
);

-- Indexes
CREATE INDEX IF NOT EXISTS "idx__cdc_comments_timestamp" ON "_cdc_comments" ("_cdc_timestamp");
CREATE INDEX IF NOT EXISTS "idx__cdc_comments_operation" ON "_cdc_comments" ("_cdc_operation");
CREATE INDEX IF NOT EXISTS "idx__cdc_comments_acknowledge" ON "_cdc_comments" ("_cdc_acknowledge");
CREATE INDEX IF NOT EXISTS "idx__cdc_comments_unprocessed" ON "_cdc_comments" ("_cdc_acknowledge", "_cdc_timestamp") WHERE "_cdc_acknowledge" = FALSE;

-- ============================================
-- CDC Table for: groups
-- Description: Generic group changes
-- ============================================

CREATE TABLE IF NOT EXISTS "_cdc_groups" (
  -- CDC Metadata Columns
  "_cdc_id" SERIAL PRIMARY KEY,
  "_cdc_timestamp" TIMESTAMP NOT NULL DEFAULT NOW(),
  "_cdc_operation" VARCHAR(10) NOT NULL CHECK ("_cdc_operation" IN ('INSERT', 'UPDATE', 'DELETE')),
  "_cdc_acknowledge" BOOLEAN NOT NULL DEFAULT FALSE,
  
  -- Original Table Columns
  "id" INTEGER,
  "name" VARCHAR(100),
  "description" VARCHAR(255),
  "owner_type" VARCHAR(50),
  "owner_id" INTEGER,
  "is_deleted" BOOLEAN,
  "edited_at" TIMESTAMP,
  "edited_by" INTEGER,
  "edited_session" VARCHAR
);

-- Indexes
CREATE INDEX IF NOT EXISTS "idx__cdc_groups_timestamp" ON "_cdc_groups" ("_cdc_timestamp");
CREATE INDEX IF NOT EXISTS "idx__cdc_groups_operation" ON "_cdc_groups" ("_cdc_operation");
CREATE INDEX IF NOT EXISTS "idx__cdc_groups_acknowledge" ON "_cdc_groups" ("_cdc_acknowledge");
CREATE INDEX IF NOT EXISTS "idx__cdc_groups_unprocessed" ON "_cdc_groups" ("_cdc_acknowledge", "_cdc_timestamp") WHERE "_cdc_acknowledge" = FALSE;

-- ============================================
-- CDC Table for: groupMemberships
-- Description: Group membership changes
-- ============================================

CREATE TABLE IF NOT EXISTS "_cdc_groupMemberships" (
  -- CDC Metadata Columns
  "_cdc_id" SERIAL PRIMARY KEY,
  "_cdc_timestamp" TIMESTAMP NOT NULL DEFAULT NOW(),
  "_cdc_operation" VARCHAR(10) NOT NULL CHECK ("_cdc_operation" IN ('INSERT', 'UPDATE', 'DELETE')),
  "_cdc_acknowledge" BOOLEAN NOT NULL DEFAULT FALSE,
  
  -- Original Table Columns
  "group_id" INTEGER,
  "member_type" VARCHAR(50),
  "member_id" INTEGER,
  "is_deleted" BOOLEAN,
  "edited_at" TIMESTAMP,
  "edited_by" INTEGER,
  "edited_session" VARCHAR
);

-- Indexes
CREATE INDEX IF NOT EXISTS "idx__cdc_groupMemberships_timestamp" ON "_cdc_groupMemberships" ("_cdc_timestamp");
CREATE INDEX IF NOT EXISTS "idx__cdc_groupMemberships_operation" ON "_cdc_groupMemberships" ("_cdc_operation");
CREATE INDEX IF NOT EXISTS "idx__cdc_groupMemberships_acknowledge" ON "_cdc_groupMemberships" ("_cdc_acknowledge");
CREATE INDEX IF NOT EXISTS "idx__cdc_groupMemberships_unprocessed" ON "_cdc_groupMemberships" ("_cdc_acknowledge", "_cdc_timestamp") WHERE "_cdc_acknowledge" = FALSE;

-- ============================================
-- CDC Table for: companies
-- Description: Company information changes
-- ============================================

CREATE TABLE IF NOT EXISTS "_cdc_companies" (
  -- CDC Metadata Columns
  "_cdc_id" SERIAL PRIMARY KEY,
  "_cdc_timestamp" TIMESTAMP NOT NULL DEFAULT NOW(),
  "_cdc_operation" VARCHAR(10) NOT NULL CHECK ("_cdc_operation" IN ('INSERT', 'UPDATE', 'DELETE')),
  "_cdc_acknowledge" BOOLEAN NOT NULL DEFAULT FALSE,
  
  -- Original Table Columns
  "id" INTEGER,
  "name" VARCHAR(100),
  "domain" VARCHAR(100),
  "slug" VARCHAR(100),
  "location" VARCHAR(100),
  "description" VARCHAR(255),
  "phone" VARCHAR(255),
  "email" VARCHAR(255),
  "address" VARCHAR(255),
  "template" JSONB,
  "is_deleted" BOOLEAN,
  "edited_at" TIMESTAMP,
  "edited_by" INTEGER,
  "edited_session" VARCHAR
);

-- Indexes
CREATE INDEX IF NOT EXISTS "idx__cdc_companies_timestamp" ON "_cdc_companies" ("_cdc_timestamp");
CREATE INDEX IF NOT EXISTS "idx__cdc_companies_operation" ON "_cdc_companies" ("_cdc_operation");
CREATE INDEX IF NOT EXISTS "idx__cdc_companies_acknowledge" ON "_cdc_companies" ("_cdc_acknowledge");
CREATE INDEX IF NOT EXISTS "idx__cdc_companies_unprocessed" ON "_cdc_companies" ("_cdc_acknowledge", "_cdc_timestamp") WHERE "_cdc_acknowledge" = FALSE;

-- ============================================
-- CDC Table for: payments
-- Description: Payment record changes
-- ============================================

CREATE TABLE IF NOT EXISTS "_cdc_payments" (
  -- CDC Metadata Columns
  "_cdc_id" SERIAL PRIMARY KEY,
  "_cdc_timestamp" TIMESTAMP NOT NULL DEFAULT NOW(),
  "_cdc_operation" VARCHAR(10) NOT NULL CHECK ("_cdc_operation" IN ('INSERT', 'UPDATE', 'DELETE')),
  "_cdc_acknowledge" BOOLEAN NOT NULL DEFAULT FALSE,
  
  -- Original Table Columns
  "id" INTEGER,
  "date" TIMESTAMP,
  "value_date" TIMESTAMP,
  "amount" INTEGER,
  "currency" INTEGER,
  "functional_unit_id" INTEGER,
  "is_deleted" BOOLEAN,
  "edited_at" TIMESTAMP,
  "edited_by" INTEGER,
  "edited_session" VARCHAR
);

-- Indexes
CREATE INDEX IF NOT EXISTS "idx__cdc_payments_timestamp" ON "_cdc_payments" ("_cdc_timestamp");
CREATE INDEX IF NOT EXISTS "idx__cdc_payments_operation" ON "_cdc_payments" ("_cdc_operation");
CREATE INDEX IF NOT EXISTS "idx__cdc_payments_acknowledge" ON "_cdc_payments" ("_cdc_acknowledge");
CREATE INDEX IF NOT EXISTS "idx__cdc_payments_unprocessed" ON "_cdc_payments" ("_cdc_acknowledge", "_cdc_timestamp") WHERE "_cdc_acknowledge" = FALSE;

-- ============================================
-- CDC Table for: unitOwnersMap
-- Description: Unit ownership changes
-- ============================================

CREATE TABLE IF NOT EXISTS "_cdc_unitOwnersMap" (
  -- CDC Metadata Columns
  "_cdc_id" SERIAL PRIMARY KEY,
  "_cdc_timestamp" TIMESTAMP NOT NULL DEFAULT NOW(),
  "_cdc_operation" VARCHAR(10) NOT NULL CHECK ("_cdc_operation" IN ('INSERT', 'UPDATE', 'DELETE')),
  "_cdc_acknowledge" BOOLEAN NOT NULL DEFAULT FALSE,
  
  -- Original Table Columns
  "user_id" INTEGER,
  "functional_unit_id" INTEGER,
  "ownership_percentage" TEXT,
  "principal" BOOLEAN,
  "is_deleted" BOOLEAN,
  "edited_at" TIMESTAMP,
  "edited_by" INTEGER,
  "edited_session" VARCHAR
);

-- Indexes
CREATE INDEX IF NOT EXISTS "idx__cdc_unitOwnersMap_timestamp" ON "_cdc_unitOwnersMap" ("_cdc_timestamp");
CREATE INDEX IF NOT EXISTS "idx__cdc_unitOwnersMap_operation" ON "_cdc_unitOwnersMap" ("_cdc_operation");
CREATE INDEX IF NOT EXISTS "idx__cdc_unitOwnersMap_acknowledge" ON "_cdc_unitOwnersMap" ("_cdc_acknowledge");
CREATE INDEX IF NOT EXISTS "idx__cdc_unitOwnersMap_unprocessed" ON "_cdc_unitOwnersMap" ("_cdc_acknowledge", "_cdc_timestamp") WHERE "_cdc_acknowledge" = FALSE;

